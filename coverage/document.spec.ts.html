<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for document.spec.ts</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="prettify.css" />
    <link rel="stylesheet" href="base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="index.html">All files</a> document.spec.ts
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">91.51% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>97/106</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">50% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>6/12</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">91.18% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>31/34</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">96.88% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>93/96</span>
      </div>
    </div>
  </div>
  <div class='status-line high'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155</td><td class="line-coverage quiet"><span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">11x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">import {access, unlinkSync} from 'fs'
import {join} from 'path'
import * as tap from 'tape'
import {Document, FontEncoding} from './document'
import {EncryptOption} from './encrypt'
import {F_OK} from "constants";
import {v4} from 'uuid'
import {Test} from "tape";
&nbsp;
const filePath = join(__dirname, '../test-documents/test.pdf'),
    pwdDoc = join(__dirname, '../test-documents/pwd.pdf')
&nbsp;
export const end = (...tests: Test[]) =&gt; tests.forEach(t =&gt; t.end())
&nbsp;
tap('Document Api', sub =&gt; {
    sub.test('unprotected documents', standard =&gt; {
        const doc = new Document(filePath)
        doc.on('ready', (pdf: Document) =&gt; {
&nbsp;
            standard.test('loaded successfully and emitted ready event', t =&gt; {
                <span class="missing-if-branch" title="if path not taken" >I</span>if (pdf instanceof Error) <span class="cstat-no" title="statement not covered" >t.fail('Failed to load document')</span>
                t.assert(pdf.loaded === true, 'pdf successfully loaded')
                end(t)
            })
&nbsp;
            standard.test('document properties getter/setter (s)', t =&gt; {
                t.assert(pdf.getPageCount() &gt; 0, 'Page count exists')
                t.throws(() =&gt; pdf.password, 'Passwords are kept secret')
                t.doesNotThrow(() =&gt; pdf.encrypt, 'Encrypt should not throw, if not exits return null')
                end( t)
            })
&nbsp;
            standard.test('document create font', t =&gt; {
                let font = pdf.createFont({fontName: 'monospace', encoding: FontEncoding.WinAnsi})
                const m = font.getMetrics()
                t.ok(m)
                end( t)
            })
&nbsp;
            standard.test('document delete page object by index', t =&gt; {
                const beforeCount = pdf.getPageCount()
                pdf.deletePage(0)
                const afterCount = pdf.getPageCount()
                t.assert(beforeCount - 1 === afterCount, 'Page removed and page count decremented')
                end( t)
            })
&nbsp;
            standard.test('document information', t =&gt; {
                t.false(pdf.isLinearized(), 'test.pdf is a non-linearized document')
                t.true(pdf.getVersion() === 1.7, 'test.pdf PDF version is 1.7')
                end( t)
            })
&nbsp;
            standard.test('can write', t =&gt; {
                const outFile = `${v4()}.pdf`
                pdf.write((e, v) =&gt; {
                    <span class="missing-if-branch" title="if path not taken" >I</span>if (e instanceof Error) <span class="cstat-no" title="statement not covered" >t.fail('Failed to write document')</span>
                    access(outFile, F_OK, err =&gt; {
                        <span class="missing-if-branch" title="if path not taken" >I</span>if (err) <span class="cstat-no" title="statement not covered" >t.fail('Failed to write document')</span>
                        else {
                            unlinkSync(outFile)
                            t.pass("Modified file written successfully")
                            end( t)
                        }
                    })
                }, outFile)
            })
        })
&nbsp;
        sub.test('document exceptions', standard =&gt; {
            standard.plan(2)
            standard.test('password required', t =&gt; {
                const doc = new Document(pwdDoc)
                doc.on('ready', <span class="fstat-no" title="function not covered" >() </span>=&gt; {
<span class="cstat-no" title="statement not covered" >                    t.fail('Should have thrown password required error')</span>
                })
                    .on('error', e =&gt; {
                        t.ok(e instanceof Error, 'should bubble up error')
                        t.assert(e.message === "Password required to modify this document")
                        end( t)
                    })
            })
            standard.test('file not found', t =&gt; {
                let doc = new Document('/bad/path')
                doc.on('ready', <span class="fstat-no" title="function not covered" >e </span>=&gt; {
<span class="cstat-no" title="statement not covered" >                    t.fail('should have thrown "file not found" error.')</span>
                })
                    .on('error', (e: Error) =&gt; {
                        t.assert(e.message === 'file not found')
                        end( t)
                    })
            })
        })
&nbsp;
        sub.test('document merger', standard =&gt; {
            const doc = new Document(filePath),
                outFile = `${v4()}.pdf`
            doc.on('ready', () =&gt; {
                let originalPC = doc.getPageCount()
                doc.mergeDocument(filePath)
                doc.write(e =&gt; {
                    <span class="missing-if-branch" title="if path not taken" >I</span>if (e) <span class="cstat-no" title="statement not covered" >standard.fail(e.message)</span>
                    const doc2 = new Document(outFile)
                    doc2.on('ready', () =&gt; {
                        let doc2PC = doc2.getPageCount()
                        standard.assert(originalPC * 2 === doc2PC, "merged document")
                        unlinkSync(outFile)
                        end(standard)
                    })
                }, outFile)
            })
        })
&nbsp;
        sub.test('encryption: user password', standard =&gt; {
            const doc = new Document(filePath),
                encryptionOption: EncryptOption = {
                    ownerPassword: 'secret',
                    userPassword: 'secret',
                    keyLength: 40,
                    protection: ['Edit', 'FillAndSign'],
                    algorithm: 'aesv3'
                },
                secureDoc = join(__dirname, '../test-documents/secure.pdf')
            doc.on('ready', () =&gt; {
                doc.createEncrypt(encryptionOption)
                doc.write(e =&gt; {
                    <span class="missing-if-branch" title="if path not taken" >I</span>if (e) <span class="cstat-no" title="statement not covered" >standard.fail(e.message)</span>
                    let sDoc: Document = new Document(secureDoc)
                    sDoc
                        .on('ready', <span class="fstat-no" title="function not covered" >() </span>=&gt; {
<span class="cstat-no" title="statement not covered" >                            standard.fail("Password required error should have been thrown.")</span>
                        }).on('error', e =&gt; {
                        end(standard)
                    })
                }, secureDoc)
            })
        })
&nbsp;
        sub.test('write buffer', standard =&gt; {
            const doc = new Document(filePath)
            doc.on('ready', (pdf: Document) =&gt; {
                pdf.write((e, d) =&gt; {
                    <span class="missing-if-branch" title="if path not taken" >I</span>if (e) <span class="cstat-no" title="statement not covered" >standard.fail(e.message)</span>
                    else {
                        standard.ok(d)
                        standard.assert(d instanceof Buffer)
                        standard.assert((d as Buffer).length &gt; 0)
                        end(standard)
                    }
                })
            })
        })
    })
&nbsp;
})</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="https://istanbul.js.org/" target="_blank">istanbul</a> at Wed Feb 28 2018 16:13:55 GMT-0800 (PST)
</div>
</div>
<script src="prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="sorter.js"></script>
</body>
</html>
